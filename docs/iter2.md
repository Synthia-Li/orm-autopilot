# Development Log: Iteration 2

Author: Zhijing Hu

## Specifications

This iteration will make a fully funtional product. We are going to:

1. Implement the actual ChatGPT API calls to get feedback about a piece of ORM code.
2. Implement user login features to serve multiple users.

### Route Design

1. Given an unauthenticated user, any requests to our app will be redirected to `/login` page to require log in.
2. From the `/login` page, a user may sign up by following a "Sign Up" link. The link will redirect 
the user to `/signup` page, which should be handled by `users_controller#new`.
3. The `/signup` page should provide a form with **email, password**. When a user finishes
sign-up and clicks "Submit", a new user record should be added to the database, and the user should be redirected to
its own home page `/user/{user_id}/orms`.
4. In the user's home page, there should be a link for the user to update its password. 
It will be redirected to `/user/{user_id}/edit` page to submit the relevant forms, which will be handled by
`users_controller#edit`.
5. For code review related operations, we follow the classic RESTful design as 
`/user/{user_id}/orms/<new | {review_id}>`. The logic is the same as iteration 1.

### Notices

1. When signing up, the user should NOT be allowed to use an existing email. The user model should check this.
2. We use cookies to authenticate a logged-in user. If the logged-in user tries to access other users' resource,
we should redirect it to the `/login` page.
3. User passwords should be stored as hashes. When creating a user record in the user database, we should generate
a **salt** randomly, append the salt to the plain-text password, hash it, then store it in the "password" column. 
Any hash algorithms (MD5, SHA1, SHA256...) are acceptable.
4. The `User` model should provide a public method `login_as(user_email)` to help Cucumber to authenticate 
a testing user. The mothod will set a token for the user identified by `user_email`.
5. All ChatGPT-related API calls should be handled by the [`chat`](../app/models/chat.rb) model, so that I can
stub out them in user stories.
6. Every time we invoke ChatGPT APIs, we should check if the user provides its own API key, and prioritize the 
user-provided API key.

### Page Description

1. For the user home page `/user/{user_id}/orms`, we should list all code review histories as a table as follows:
```
| Title(generated by ChatGPT) |    Last Updated     |
| --------------------------- | ------------------- |
|   <a>code review 1</a>      | yyyy-mm-dd hh:mm:ss |
|   <a>code review 2</a>      | yyyy-mm-dd hh:mm:ss |
|   ...                       | ...                 |
```
Note that each table entry will direct the user to the detail page of that code review.

2. When a user fails to login, the login page should display a flash `Incorrect username/password`.
3. When a user fails to sign up due to duplicated email, the sign up page should display a flash `Fail to sign up. Account already exists`.
4. When a user successfully deletes a chat review, it will be redirected to the home page with a flash
notice prompting that `chat "..." was deleted`.

## Tasks

### To @haonanw98

1. Create and fill in the model and controller of user login features.
2. Implement the function of generating a title for a piece of ORM code.
3. Adjust the prompt written by @Synthia-Li to better tune the feedback of ChatGPT.
4. Implement new routes.

### To @Synthia-Li

Implement the API call to generate feedback for ORM code.

### To @nikington2314

1. Write views for user login(`/signup` and `/login`).
2. Implement the flash notices during user login and code review deletion.

### To @endless-hu

1. Write Cucumber user stories to cover most scenarios. 
2. Write docs to architect the project.
3. Deploy to Heroku.
4. Refactor and adjust codes to ensure tests to pass.
